# Лабораторная работа №1. Настройка окружения и разведочный анализ данных

## Описание проекта
Данный проект создан в рамках выполнения лабораторной работы №1.  
Основная цель — подготовка структуры проекта, настройка рабочего окружения и проведение разведочного анализа данных (EDA).  
В дальнейшем этот проект будет развиваться при выполнении следующих лабораторных работ.

---

## Структура проекта
На текущем этапе структура проекта имеет вид:
```
lab_1iis
|_____ .venv_my_proj # виртуальное окружение
|_____ .git # локальный репозиторий
|_____ data # папка с исходными и промежуточными данными
| |___ dataset.csv # исходный датасет
| |___ clean_dataset.pkl # очищенный датасет
|
|_____ eda # папка с EDA
| |___ eda.ipynb # блокнот с разведочным анализом данных
|
|_____ graph # графики с EDA
|  |___ graph2.png
|  |___ ...
|
|_____ research # Ноутбук с графики исследований лучшей модели
|  |___ research.ipynb
|  |___ ...
|
|_____ .gitignore
|_____ README.md
|_____ requirements.txt
```

## Запуск проекта
Чтобы развернуть проект на другой машине, выполните следующие шаги:

1. **Клонировать репозиторий:**
```textmate
git clone https://github.com/Halssara/lab1_iis.git
cd lab_1iis
```

2. **Создать и активировать виртуальное окружение:**
```textmate
python3 -m venv venv
source venv/bin/activate
```

3. **Установить зависимости:**
```textmate
pip install -r requirements.txt
```
4. **Загрузить датасет:**
https://www.kaggle.com/datasets/krishujeniya/heart-diseae
Скопируйте исходный `dataset.csv` в папку `data/`.

6. **Запустить EDA:**  
Открыть блокнот:
```textmate
jupyter notebook eda/eda.ipynb
```
## Результаты EDA

В ходе проведения разведочного анализа данных были выполнены следующие шаги:

1. **Загрузка и знакомство с данными**  
   - Определены числовые и категориальные признаки.  
   - Проверены типы данных 

2. **Очистка данных**  
   - Удалены дубликаты и невалидные значения.  
   - Обработаны пропущенные значения.

3. **Анализ признаков**  
   - Построены графики распределения фичей, матрица корреляции, распределение таргета относительно возраста, интерактивный график целевой переменной в осях холестерина и макимальной частоты биения сердца.  
   - Выявлены зависимости между признаками и целевой переменной.  
   - Определены признаки, которые могут сильно влиять на результат модели.  

4. **Создание новых признаков**  
   - Сформирован дополнительный признак из возраста  

5. **Сохранение данных**  
   - Финальный очищенный датасет сохранён в формате `.pkl` для корректного хранения типов данных.  



***
### Выводы которые были получены в ходе EDA

- Признак `oldpeak` — сильно смещён влево, большинство значений невысокие, есть длинный правый хвост. Значения выше 2 встречаются редко.
- Признак `thalach` (максимальная частота сердцебиения) имеет распределение, близкое к нормальному, большинство наблюдений в диапазоне 130–170.
- Признак `fbs` (повышенный сахар натощак) — почти у всех наблюдений значение 0, лишь небольшая часть имеет 1, признак дисбалансирован.
- Признак `restecg` — две «группы», почти равное разделение по двум значениям, что может указывать на диагностическую особенность.
- Признак `thal` — распределён по трем основным классам, выраженный дисбаланс.
- Признак `age` — нормальное распределение с пиком в районе 55–60 лет, малое число молодых и пожилых пациентов.
- Признак `slope` — две группы с разной популярностью, большая часть принимает значения 1 и 2.
- Признак `exang` (стенокардия при нагрузке) — основной класс 0, меньшинство с 1.
- Признак `chol` (уровень холестерина) имеет асимметричное распределение с выбросами вправо, большинство наблюдений в диапазоне 200–300.
- Признак `target` (наличие заболевания) — почти равномерно распределён по классам, что положительно для обучения модели.
- Признак `trestbps` (давление в покое) — распределение близко к нормальному, небольшой правый хвост.
- Признак `sex` — около двух третей мужчин, треть женщин.
- Признак `ca` (количество сосудов, окрашенных контрастом) — выраженный перекос в сторону нулевых значений.
- Признак `cp` (тип боли в груди) — наибольшая часть наблюдений приходится на класс 0, далее классы 2 и 1, а последний встречается редко.
- Корреляционная матрица показывает, что целевая переменная заметно зависит от признаков: `cp`, `thalach` (положительно), `oldpeak`, `exang`, `ca`, `slope` (отрицательно).
- Boxplot возраста по целевой переменной показывает: среди больных возрастное распределение смещено левее, чем у здоровых — то есть болезнь сердца встречается чаще среди относительно молодых пациентов данного исследования.
- По интерактивному графику "Холестерин видно, что пациенты с заболеванием сердца (target = 1, отмечены жёлтым цветом) имеют тенденцию к более высокой максимальной частоте сердцебиения (thalach), а распределение уровня холестерина (chol) в обеих группах перекрывается. Нет чёткой линейной зависимости между холестерином и сердечным заболеванием, однако большое число больных имеет thalach выше среднего. Также видно, что значения chol выше 400 встречаются только у больных, но выборка для таких случаев небольшая. В целом, максимальная частота сердцебиения потенциально является более информативным признаком для выделения целевой переменной, чем уровень холестерина.
***

### Основные выводы
- Данные успешно загружены и очищены.  
- Были выявлены статистические закономерности, которые помогут при построении модели.  
- Построены графики, подтверждающие зависимость целевой переменной от ключевых признаков.  
- Проект готов к дальнейшей разработке
- Возраст (`age`) имеет распределение с пиком около 55-60 лет, что важно учитывать при анализе риска.
- Признак максимальной частоты сердцебиения (`thalach`) ниже у пациентов с болезнью сердца, что может служить индикатором.
- Во многих категориальных признаках (например, `cp` — тип боли, `slope`) есть доминирующие значения, что поможет при создании категориальных признаков.
- Уровень холестерина (`chol`) в целом выше у больных, но есть значительное пересечение с группой здоровых, поэтому этот признак стоит использовать в сочетании с другими.
- Признаки, связанные с физическим состоянием сердца при нагрузке (`exang`, `oldpeak`), хорошо разделяют классы.
- Корреляционная матрица показывает, что признаки `cp`, `thalach`, `slope`, `oldpeak` и `exang` имеют заметные связи с целевой переменной.
- Признак `target` равномерно распределён, что положительно скажется на обучении модели без сильного перекоса классов.
- Пропущенные и аномальные значения были удалены, что улучшит качество модели.
---


# Лабораторная работа №2. Настройка и исследование моделей машинного обучения

## Цель работы
Основная цель лабораторной работы №2 — провести исследования по настройке и подбору параметров моделей машинного обучения для улучшения качества предсказаний на подготовленном датасете.

## Задачи работы
- Изучить методы предварительной настройки и отбора гиперпараметров моделей.
- Провести настройку различных моделей с использованием выбранных критериев.
- Произвести отбор признаков по важности.
- Провести оценку качества моделей по метрикам.
- Сравнить результаты различных настроек и подобрать лучшую конфигурацию.

## Описание процесса
- На основе подготовленного очищенного датасета построены модели машинного обучения, в том числе с использованием методов sklearn.
- Выполнено логирование модели и её параметров в MLflow.
- Изучены результаты работы модели, проведён отбор признаков с сохранением списка в отдельный JSON-файл.
- Зафиксированы зависимости качества моделей от используемых признаков.

## Результаты ЛР2
- Проведена настройка параметров моделей Random Forest, CatBoost.
- Настроена и зарегистрирована лучшая модель с её сигнатурой и логами.
- Выполнено логирование необходимых артефактов, в том числе файла `best_features.json` с набором выделенных признаков и `requirements.txt`.
- В интерфейсе MLflow отображаются результаты запусков, параметры, метрики и артефакты модели.

---

# Дополнительно

Для запуска mlflow выполнить

```ps1
mlflow server `
    --backend-store-uri sqlite:///mlruns.db `
    --default-artifact-root ./mlartifacts `
    --host localhost `
    --port 5000
```

После запуска откроыть в браузере http://localhost:5000 для просмотра результатов.


## Использование MLflow
В проекте используется MLflow для отслеживания экспериментов и управления версиями моделей. Для запуска сервера MLflow выполните: